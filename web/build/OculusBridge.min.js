/*! OculusBridge 2013-07-19 */
var OculusBridge=function(a){var b,c=!0,d=a.hasOwnProperty("address")?a.address:"localhost",e=a.hasOwnProperty("port")?a.port:9e3,f=a.hasOwnProperty("retryInterval")?a.retryInterval:1,g=a.hasOwnProperty("debug")?a.debug:!1,h=0,i=0,j=0,k=0,l={FOV:125.871,hScreenSize:.14976,vScreenSize:.0935,vScreenCenter:.04675,eyeToScreenDistance:.041,lensSeparationDistance:.067,interpupillaryDistance:.0675,hResolution:1280,vResolution:720,distortionK:[1,.22,.24,0],chromaAbParameter:[.996,-.004,1.014,0]},m={onOrientationUpdate:null,onConfigUpdate:null,onConnect:null,onDisconnect:null};for(var n in m)"function"==typeof a[n]&&(m[n]=a[n]);var o=function(a){a.o&&4==a.o.length&&(h=Number(a.o[1]),i=Number(a.o[2]),j=Number(a.o[3]),k=Number(a.o[0]),m.onOrientationUpdate&&m.onOrientationUpdate(k,h,i,j))},p=function(a){l.hScreenSize=a.screenSize[0],l.vScreenSize=a.screenSize[1],l.vScreenCenter=a.screenSize[1]/2,l.eyeToScreenDistance=a.eyeToScreen,l.lensSeparationDistance=a.lensDistance,l.interpupillaryDistance=a.interpupillaryDistance,l.hResolution=a.screenResolution[0],l.vResolution=a.screenResolution[1],l.distortionK=[a.distortion[0],a.distortion[1],a.distortion[2],a.distortion[3]],l.FOV=a.fov,m.onConfigUpdate&&m.onConfigUpdate(l)},q=function(){c=!0;var a="ws://"+d+":"+e+"/";b=new WebSocket(a),r("Attempting to connect: "+a),b.onopen=function(){r("Connected!"),m.onConnect&&m.onConnect()},b.onerror=function(){r("Socket error.")},b.onmessage=function(a){var b=JSON.parse(a.data),c=b.m;switch(c){case"config":p(b);break;case"orientation":o(b);break;default:r("Unknown message received from server: "+a.data),t()}},b.onclose=function(){m.onDisconnect&&m.onDisconnect(),c&&(r("Connection failed, retrying in 1 second..."),window.setTimeout(s,1e3*f))}},r=function(a){g&&console.log("OculusBridge: "+a)},s=function(){q()},t=function(){c=!1,b.close()},u=function(){return[k,h,i,j]},v=function(){return 1==b.readyState};return{isConnected:v,disconnect:t,connect:q,getOrientation:u}};